<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Piano Gallery CRM</title>
  <link rel="icon" type="image/png" href="logo.png">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fc;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    header {
      display: flex;
      align-items: center;
      background: #2c3e50;
      color: white;
      padding: 20px;
      border-radius: 0 0 10px 10px;
      margin-bottom: 30px;
    }
    header img {
      height: 60px;
      margin-right: 15px;
    }
    header h1 {
      margin: 0;
      font-size: 24px;
    }
    .card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      padding: 20px;
      margin-bottom: 20px;
    }
    .dropdown-btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
    }
    .dropdown-btn:hover { background: #2980b9; }
    .form-container { display: none; margin-top: 15px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, textarea, select {
      width: 100%; padding: 8px; margin-top: 4px;
      border: 1px solid #ccc; border-radius: 6px; font-size: 14px;
    }
    button { cursor: pointer; }
    table {
      width: 100%; border-collapse: collapse;
      background: #fff; border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    th, td {
      padding: 12px; border-bottom: 1px solid #ddd; text-align: left;
    }
    th { background: #3498db; color: #fff; }
    tr:nth-child(even) { background: #f9f9f9; }
    .actions button {
      margin-right: 5px; padding: 6px 12px;
      border: none; border-radius: 6px; color: #fff;
    }
    .actions button.edit { background: #f39c12; }
    .actions button.delete { background: #e74c3c; }
    .actions button.view { background: #2ecc71; }
    .details-row { display: none; background: #f4f6f9; }
    .details { padding: 15px; }
    .status-badge {
      padding: 4px 8px; border-radius: 6px; font-size: 12px; color: #fff;
    }
    .status-new { background: #3498db; }
    .status-working { background: #e67e22; }
    .status-closed { background: #27ae60; }
    /* Modal */
    .modal {
      display: none; position: fixed; z-index: 1000; left: 0; top: 0;
      width: 100%; height: 100%; overflow: auto;
      background: rgba(0,0,0,0.6); padding-top: 60px;
    }
    .modal-content {
      background: #fff; margin: auto; padding: 20px;
      border-radius: 10px; width: 90%; max-width: 600px;
    }
    .modal-header { display: flex; justify-content: space-between; align-items: center; }
    .close { color: #aaa; font-size: 24px; cursor: pointer; }
    .close:hover { color: #000; }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo">
    <h1>Piano Gallery CRM</h1>
  </header>

  <div class="card">
    <button class="dropdown-btn" onclick="toggleForm()">+ Add Client</button>
    <div class="form-container" id="formContainer">
      <form id="clientForm">
        <label>Name: <input type="text" id="name" required></label>
        <label>Phone: <input type="text" id="phone"></label>
        <label>Email: <input type="email" id="email"></label>
        <label>Piano: <input type="text" id="piano"></label>
        <label>Last Contacted: <input type="date" id="lastContacted"></label>
        <label>Status:
          <select id="status">
            <option value="New Lead">New Lead</option>
            <option value="Working Deal">Working Deal</option>
            <option value="Closed">Closed</option>
          </select>
        </label>
        <label>Lead Owner:
          <select id="owner">
            <option value="Ethan">Ethan</option>
            <option value="Tristan">Tristan</option>
            <option value="Dan">Dan</option>
            <option value="Other">Other</option>
          </select>
        </label>
        <label>Cost: <input type="number" id="cost" step="0.01"></label>
        <label>Timeline: <input type="text" id="timeline"></label>
        <label>Notes: <textarea id="notes"></textarea></label>
        <div id="closedFields" style="display:none;">
          <label>Time of Sale: <input type="datetime-local" id="timeOfSale"></label>
          <label>Delivery Location: <input type="text" id="deliveryLocation"></label>
          <label>Number of Stairs: <input type="number" id="stairs"></label>
          <label>Piano Sold: <input type="text" id="pianoSold"></label>
        </div>
        <button type="submit">Save Client</button>
      </form>
    </div>
  </div>

  <table id="clientTable">
    <thead>
      <tr>
        <th>Name</th><th>Phone</th><th>Email</th><th>Piano</th><th>Last Contacted</th><th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Client</h2>
        <span class="close" onclick="closeModal()">&times;</span>
      </div>
      <form id="editForm"></form>
    </div>
  </div>

  <script>
    const form = document.getElementById('clientForm');
    const tableBody = document.querySelector('#clientTable tbody');
    const statusField = document.getElementById('status');
    const closedFields = document.getElementById('closedFields');
    let clients = JSON.parse(localStorage.getItem('clients') || '[]');
    let editingIndex = null;

    function toggleForm() {
      const container = document.getElementById('formContainer');
      container.style.display = container.style.display === 'none' || container.style.display === '' ? 'block' : 'none';
    }

    statusField.addEventListener('change', () => {
      closedFields.style.display = statusField.value === 'Closed' ? 'block' : 'none';
    });

    form.addEventListener('submit', e => {
      e.preventDefault();
      const newClient = getFormData();
      clients.push(newClient);
      saveAndRender();
      form.reset();
      closedFields.style.display = 'none';
    });

    function getFormData() {
      return {
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value,
        email: document.getElementById('email').value,
        piano: document.getElementById('piano').value,
        lastContacted: document.getElementById('lastContacted').value,
        status: document.getElementById('status').value,
        owner: document.getElementById('owner').value,
        cost: document.getElementById('cost').value,
        timeline: document.getElementById('timeline').value,
        notes: document.getElementById('notes').value,
        timeOfSale: document.getElementById('timeOfSale').value,
        deliveryLocation: document.getElementById('deliveryLocation').value,
        stairs: document.getElementById('stairs').value,
        pianoSold: document.getElementById('pianoSold').value
      };
    }

    function saveAndRender() {
      localStorage.setItem('clients', JSON.stringify(clients));
      renderClients();
    }

    function renderClients() {
      tableBody.innerHTML = '';
      clients.forEach((c, i) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${c.name}</td>
          <td>${c.phone}</td>
          <td>${c.email}</td>
          <td>${c.piano}</td>
          <td>${c.lastContacted || ''}</td>
          <td class="actions">
            <button class="view" onclick="toggleDetails(${i})">View</button>
            <button class="edit" onclick="openEdit(${i})">Edit</button>
            <button class="delete" onclick="deleteClient(${i})">Delete</button>
          </td>
        `;
        tableBody.appendChild(row);
        // Details row
        const detailsRow = document.createElement('tr');
        detailsRow.classList.add('details-row');
        detailsRow.id = 'details-' + i;
        detailsRow.innerHTML = `
          <td colspan="6">
            <div class="details">
              <p><strong>Status:</strong> <span class="status-badge ${statusClass(c.status)}">${c.status || ''}</span></p>
              <p><strong>Owner:</strong> ${c.owner || ''}</p>
              <p><strong>Cost:</strong> ${c.cost || ''}</p>
              <p><strong>Timeline:</strong> ${c.timeline || ''}</p>
              <p><strong>Notes:</strong> ${c.notes || ''}</p>
              ${c.status === 'Closed' ? `
                <p><strong>Time of Sale:</strong> ${c.timeOfSale || ''}</p>
                <p><strong>Delivery Location:</strong> ${c.deliveryLocation || ''}</p>
                <p><strong>Stairs:</strong> ${c.stairs || ''}</p>
                <p><strong>Piano Sold:</strong> ${c.pianoSold || ''}</p>
              ` : ''}
            </div>
          </td>
        `;
        tableBody.appendChild(detailsRow);
      });
    }

    function statusClass(status) {
      if (status === 'Working Deal') return 'status-working';
      if (status === 'Closed') return 'status-closed';
      return 'status-new';
    }

    function toggleDetails(i) {
      const details = document.getElementById('details-' + i);
      details.style.display = details.style.display === 'table-row' ? 'none' : 'table-row';
    }

    function deleteClient(i) {
      clients.splice(i, 1);
      saveAndRender();
    }

    function openEdit(i) {
      editingIndex = i;
      const c = clients[i];
      const formHtml = `
        <label>Name: <input type="text" id="editName" value="${c.name || ''}"></label>
        <label>Phone: <input type="text" id="editPhone" value="${c.phone || ''}"></label>
        <label>Email: <input type="email" id="editEmail" value="${c.email || ''}"></label>
        <label>Piano: <input type="text" id="editPiano" value="${c.piano || ''}"></label>
        <label>Last Contacted: <input type="date" id="editLastContacted" value="${c.lastContacted || ''}"></label>
        <label>Status:
          <select id="editStatus">
            <option ${c.status==='New Lead'?'selected':''}>New Lead</option>
            <option ${c.status==='Working Deal'?'selected':''}>Working Deal</option>
            <option ${c.status==='Closed'?'selected':''}>Closed</option>
          </select>
        </label>
        <label>Owner:
          <select id="editOwner">
            <option ${c.owner==='Ethan'?'selected':''}>Ethan</option>
            <option ${c.owner==='Tristan'?'selected':''}>Tristan</option>
            <option ${c.owner==='Dan'?'selected':''}>Dan</option>
            <option ${c.owner==='Other'?'selected':''}>Other</option>
          </select>
        </label>
        <label>Cost: <input type="number" id="editCost" step="0.01" value="${c.cost || ''}"></label>
        <label>Timeline: <input type="text" id="editTimeline" value="${c.timeline || ''}"></label>
        <label>Notes: <textarea id="editNotes">${c.notes || ''}</textarea></label>
        <div id="editClosedFields" ${c.status==='Closed'?'':'style="display:none;"'}>
          <label>Time of Sale: <input type="datetime-local" id="editTimeOfSale" value="${c.timeOfSale || ''}"></label>
          <label>Delivery Location: <input type="text" id="editDeliveryLocation" value="${c.deliveryLocation || ''}"></label>
          <label>Stairs: <input type="number" id="editStairs" value="${c.stairs || ''}"></label>
          <label>Piano Sold: <input type="text" id="editPianoSold" value="${c.pianoSold || ''}"></label>
        </div>
        <button type="button" onclick="saveEdit()">Save</button>
      `;
      document.getElementById('editForm').innerHTML = formHtml;
      document.getElementById('editStatus').addEventListener('change', e => {
        document.getElementById('editClosedFields').style.display = e.target.value === 'Closed' ? 'block' : 'none';
      });
      document.getElementById('editModal').style.display = 'block';
    }

    function closeModal() {
      document.getElementById('editModal').style.display = 'none';
    }

    function saveEdit() {
      const c = clients[editingIndex];
      c.name = document.getElementById('editName').value;
      c.phone = document.getElementById('editPhone').value;
      c.email = document.getElementById('editEmail').value;
      c.piano = document.getElementById('editPiano').value;
      c.lastContacted = document.getElementById('editLastContacted').value;
      c.status = document.getElementById('editStatus').value;
      c.owner = document.getElementById('editOwner').value;
      c.cost = document.getElementById('editCost').value;
      c.timeline = document.getElementById('editTimeline').value;
      c.notes = document.getElementById('editNotes').value;
      c.timeOfSale = document.getElementById('editTimeOfSale').value;
      c.deliveryLocation = document.getElementById('editDeliveryLocation').value;
      c.stairs = document.getElementById('editStairs').value;
      c.pianoSold = document.getElementById('editPianoSold').value;
      saveAndRender();
      closeModal();
    }

    renderClients();
  </script>
</body>
</html>
